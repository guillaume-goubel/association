{{ form_start(form)}}
    
    <div class="fs-14 text-base-color text-uppercase ls-1px fw-600"><i class="fa-solid fa-circle-info align-middle icon-large text-base-color me-1"></i>LES INFORMATIONS GENERALES<span class="w-120px h-1px bg-base-color d-none d-lg-inline-block align-middle position-relative top-minus-1px ms-10px lg-w-70px"></span></div>
    <div class="row d-flex aside-form">
        <div class="col-12 mt-1">
            {{ form_row(form.name) }}
        </div>
    </div>
    <div class="row d-flex aside-form">
        <div class="col-6 mt-1">
            {{ form_row(form.activity) }}
        </div>

        <div class="col-6 mt-1">
            {{ form_row(form.animators) }}
        </div>
    </div>
    
    <div class="row d-flex aside-form">
        <div class="col-6 mt-1">
            {{ form_row(form.dateStartAt) }}
        </div>

        <div class="col-6 mt-1">
            {{ form_row(form.timeStartAt) }}
        </div>
    </div>

    <div class="row d-flex aside-form">
        <div class="col-6 mt-1">
            {{ form_row(form.dateEndAt) }}
        </div>

        <div class="col-6 mt-1">
            {{ form_row(form.timeEndAt) }}
        </div>

        <div class="col-6 mt-1">
            {{ form_row(form.eventDistance) }}
        </div>
    </div>

    <div class="row d-flex aside-form">
        <div class="col-12 mt-1">
            {{ form_row(form.description) }}
        </div>

        <div class="col-12 mt-1">
            {{ form_row(form.preparationInfos) }}
        </div>

        <div class="col-12 mt-1">
            {{ form_row(form.user) }}
        </div>
    </div>

    <div class="fs-14 text-base-color text-uppercase ls-1px fw-600 mt-5"><i class="fa-solid fa-image align-middle icon-large text-base-color me-1"></i>LES PHOTOS<span class="w-120px h-1px bg-base-color d-none d-lg-inline-block align-middle position-relative top-minus-1px ms-10px lg-w-70px"></span></div>
    <div class="row d-flex aside-form">  
        <div class="col-6 mt-1">
            {{ form_row(form.mainPictureFile) }}
        </div>

        <div class="col-6 mt-1">
            {{ form_row(form.picture2File) }}
        </div>

        <div class="col-6 mt-1">
            {{ form_row(form.picture3File) }}
        </div>
    </div>


    {# AUTOCOMPLETION PART -- start #}
    <div class="fs-14 text-base-color text-uppercase ls-1px fw-600 mt-5 mb-2"><i class="fa-solid fa-map-location-dot icon-large text-base-color me-1"></i>LE LIEU DE RENDEZ-VOUS<span class="w-120px h-1px bg-base-color d-none d-lg-inline-block align-middle position-relative top-minus-1px ms-10px lg-w-70px"></span></div>
    <div class="pac-card p-1" id="pac-card">
        <div>
            <div id="title">Indiquez ici l'adresse pour auto-complétion</div>
        </div>
        <div id="pac-container" class="p-3">
            
            {% set action = 'add' %}
            
            {% if action == 'edit' %}
                <input value="{{building.streetNumber}} {{building.streetName}}, {{building.zipCode}} {{building.cityName}} , {{building.country.nomFrFr}}" id="pac-input" type="text" placeholder="ex : 41 rue XXXX , 59100, LILLE" />
            {% else %}
                <input id="pac-input" type="text" placeholder="ex : 41 rue XXXX , 59100, LILLE" />
            {% endif %}

        </div>
    </div>

    <div style="margin-left: 25px;" id="map"></div>

    <div id="infowindow-content">
        <span id="place-name" class="title"></span><br/>
        <span id="place-address"></span>
    </div>
    {# AUTOCOMPLETION PART -- end #}

    <div class="row d-flex aside-form">  
        <div class="col-6 mt-1">
            {{ form_row(form.rdvAddress) }}
        </div>

        <div class="col-6 mt-1">
            {{ form_row(form.rdvCity) }}
        </div>

        <div class="col-12 mt-1">
            {{ form_row(form.rdvPlaceName) }}
        </div>
    </div>
    
    <div class="row d-flex aside-form">  
        <div class="col-6 mt-1">
            {{ form_row(form.rdvLatitude) }}
        </div>

        <div class="col-6 mt-1">
            {{ form_row(form.rdvLongitude) }}
        </div>
    </div>

    <button type="submit" class="btn">{{ button_label|default('Enregistrer') }}</button>

{{ form_end(form) }}

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCvTjdmHt6ljHHGave6JCeDyoBRjRzOlhs&libraries=places&v=weekly" crossorigin=""></script>
<script>
    // MAP AUTO COMPLETION
    function initMap() {
                    
        const map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 50.62925, lng: 3.057256 },
                zoom: 13,
                mapTypeControl: false,
            });
            const card = document.getElementById("pac-card");
            const input = document.getElementById("pac-input");
            const options = {
                fields: ["formatted_address", "geometry", "name", "address_components"],
                strictBounds: false,
                types: ["address" ],
                // componentRestrictions: { country: "fr" }
            };

        map.controls[google.maps.ControlPosition.TOP_LEFT].push(card);

        const autocomplete = new google.maps.places.Autocomplete(input, options);

        // Bind the map's bounds (viewport) property to the autocomplete object,
        // so that the autocomplete requests use the current map bounds for the
        // bounds option in the request.
        autocomplete.bindTo("bounds", map);

        const infowindow = new google.maps.InfoWindow();
        const infowindowContent = document.getElementById("infowindow-content");

        infowindow.setContent(infowindowContent);

        const marker = new google.maps.Marker({
            map,
            anchorPoint: new google.maps.Point(0, -29),
        });

        autocomplete.addListener("place_changed", () => {
            
            infowindow.close();
            marker.setVisible(false);

            const place = autocomplete.getPlace();

            function autoCompletionForm(place) {
                
                console.log(place);

                document.getElementById("event_rdvAddress").value = "";
                document.getElementById("event_rdvCity").value = "";

                if (!place.geometry || !place.geometry.location) {
                    window.alert("No details available for input: '" + place.name + "'");
                    return;
                }

                if (place.geometry.location) {
                    document.getElementById("event_rdvLatitude").value = place.geometry.location.lat();
                    document.getElementById("event_rdvLongitude").value = place.geometry.location.lng();
                }

                if (place.address_components) {

                    let address_components = place.address_components;
                    
                    let steetVal = address_components[0].long_name;
                    document.getElementById("event_rdvAddress").value = place.formatted_address;

                    let cityName = address_components[2].long_name;
                    document.getElementById("event_rdvCity").value = cityName;

                }

            }

            if (place.geometry && place.geometry.location && place.address_components) {
                autoCompletionForm(place);
            }

            // If the place has a geometry, then present it on a map.
            if (place.geometry.viewport) {
                map.fitBounds(place.geometry.viewport);
            } else {
                map.setCenter(place.geometry.location);
                map.setZoom(17);
            }

            marker.setPosition(place.geometry.location);
            marker.setVisible(true);
            infowindowContent.children["place-name"].textContent = place.formatted_address;
            place.formatted_address;
            infowindow.open(map, marker);
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        initMap();

        // Disable enter key on form
        $(window).keydown(function(event){
            if(event.keyCode == 13) {
                if ($(document.activeElement).is('input[type="text"]')) {
                    event.preventDefault(); // Empêche la soumission du formulaire
                }
            }
        });
    });

</script>


